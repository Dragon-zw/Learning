# alertmanager-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: alert-config
  namespace: monitor
data:
  config.yml: |-
    global:
      # å½“alertmanageræŒç»­å¤šé•¿æ—¶é—´æœªæ¥æ”¶åˆ°å‘Šè­¦åæ ‡è®°å‘Šè­¦çŠ¶æ€ä¸º resolved
      resolve_timeout: 5m
      # é…ç½®é‚®ä»¶å‘é€ä¿¡æ¯
      smtp_smarthost: 'smtp.163.com:25'
      smtp_from: 'xxxxxx@163.com'
      smtp_auth_username: 'xxxxxx@163.com'
      smtp_auth_password: 'xxxxxx' # ğŸ“®é‚®ç®±çš„æˆæƒç 
      smtp_hello: '163.com'
      smtp_require_tls: false
    # æ‰€æœ‰æŠ¥è­¦ä¿¡æ¯è¿›å…¥åçš„æ ¹è·¯ç”±ï¼Œç”¨æ¥è®¾ç½®æŠ¥è­¦çš„åˆ†å‘ç­–ç•¥
    route:
      # è¿™é‡Œçš„æ ‡ç­¾åˆ—è¡¨æ˜¯æ¥æ”¶åˆ°æŠ¥è­¦ä¿¡æ¯åçš„é‡æ–°åˆ†ç»„æ ‡ç­¾ï¼Œä¾‹å¦‚ï¼Œæ¥æ”¶åˆ°çš„æŠ¥è­¦ä¿¡æ¯é‡Œé¢æœ‰è®¸å¤šå…·æœ‰ cluster=A å’Œ alertname=LatncyHigh è¿™æ ·çš„æ ‡ç­¾çš„æŠ¥è­¦ä¿¡æ¯å°†ä¼šæ‰¹é‡è¢«èšåˆåˆ°ä¸€ä¸ªåˆ†ç»„é‡Œé¢
      group_by: ['alertname', 'cluster']
      # å½“ä¸€ä¸ªæ–°çš„æŠ¥è­¦åˆ†ç»„è¢«åˆ›å»ºåï¼Œéœ€è¦ç­‰å¾…è‡³å°‘ group_wait æ—¶é—´æ¥åˆå§‹åŒ–é€šçŸ¥ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ç¡®ä¿æ‚¨èƒ½æœ‰è¶³å¤Ÿçš„æ—¶é—´ä¸ºåŒä¸€åˆ†ç»„æ¥è·å–å¤šä¸ªè­¦æŠ¥ï¼Œç„¶åä¸€èµ·è§¦å‘è¿™ä¸ªæŠ¥è­¦ä¿¡æ¯ã€‚
      group_wait: 30s

      # ç›¸åŒçš„groupä¹‹é—´å‘é€å‘Šè­¦é€šçŸ¥çš„æ—¶é—´é—´éš”
      group_interval: 30s

      # å¦‚æœä¸€ä¸ªæŠ¥è­¦ä¿¡æ¯å·²ç»å‘é€æˆåŠŸäº†ï¼Œç­‰å¾… repeat_interval æ—¶é—´æ¥é‡æ–°å‘é€ä»–ä»¬ï¼Œä¸åŒç±»å‹å‘Šè­¦å‘é€é¢‘ç‡éœ€è¦å…·ä½“é…ç½®
      repeat_interval: 1h

      # é»˜è®¤çš„receiverï¼šå¦‚æœä¸€ä¸ªæŠ¥è­¦æ²¡æœ‰è¢«ä¸€ä¸ªrouteåŒ¹é…ï¼Œåˆ™å‘é€ç»™é»˜è®¤çš„æ¥æ”¶å™¨
      receiver: default

      # ä¸Šé¢æ‰€æœ‰çš„å±æ€§éƒ½ç”±æ‰€æœ‰å­è·¯ç”±ç»§æ‰¿ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ¯ä¸ªå­è·¯ç”±ä¸Šè¿›è¡Œè¦†ç›–ã€‚
      routes:
      - receiver: email
        group_wait: 10s
        group_by: ['instance'] # æ ¹æ®instanceåšåˆ†ç»„
        match:
          team: node
    receivers:
    - name: 'default'
      email_configs:
      - to: ' 935523993@qq.com'
        send_resolved: true  # æ¥å—å‘Šè­¦æ¢å¤çš„é€šçŸ¥
    - name: 'email'
      email_configs:
      - to: '935523993@qq.com'
        send_resolved: true
    inhibit_rules:
    - source_match:
      alertname: NodeMemoryUsage
      severity: critical
    target_match:
      severity: normal
    equal:
      - instance